function PxLoaderImage(e,t,n){var r=this,i=null;this.img=new Image;this.tags=t;this.priority=n;var s=function(){if(r.img.readyState==="complete"){a();i.onLoad(r)}};var o=function(){a();i.onLoad(r)};var u=function(){a();i.onError(r)};var a=function(){r.unbind("load",o);r.unbind("readystatechange",s);r.unbind("error",u)};this.start=function(t){i=t;r.bind("load",o);r.bind("readystatechange",s);r.bind("error",u);r.img.src=e};this.checkStatus=function(){if(r.img.complete){a();i.onLoad(r)}};this.onTimeout=function(){a();if(r.img.complete){i.onLoad(r)}else{i.onTimeout(r)}};this.getName=function(){return e};this.bind=function(e,t){if(r.img.addEventListener){r.img.addEventListener(e,t,false)}else if(r.img.attachEvent){r.img.attachEvent("on"+e,t)}};this.unbind=function(e,t){if(r.img.removeEventListener){r.img.removeEventListener(e,t,false)}else if(r.img.detachEvent){r.img.detachEvent("on"+e,t)}}}(function(e){function t(e){e=e||{};this.settings=e;if(e.statusInterval==null){e.statusInterval=5e3}if(e.loggingDelay==null){e.loggingDelay=20*1e3}if(e.noProgressTimeout==null){e.noProgressTimeout=Infinity}var t=[],r=[],i,s=Date.now();var o={QUEUED:0,WAITING:1,LOADED:2,ERROR:3,TIMEOUT:4};var u=function(e){if(e==null){return[]}if(Array.isArray(e)){return e}return[e]};this.add=function(e){e.tags=new n(e.tags);if(e.priority==null){e.priority=Infinity}t.push({resource:e,status:o.QUEUED})};this.addProgressListener=function(e,t){r.push({callback:e,tags:new n(t)})};this.addCompletionListener=function(e,t){r.push({tags:new n(t),callback:function(t){if(t.completedCount===t.totalCount){e(t)}}})};var a=function(e){e=u(e);var t=function(t){var n=t.resource,r=Infinity;for(var i=0;i<n.tags.length;i++){for(var s=0;s<Math.min(e.length,r);s++){if(n.tags.all[i]===e[s]&&s<r){r=s;if(r===0){break}}if(r===0){break}}}return r};return function(e,n){var r=t(e),i=t(n);if(r<i){return-1}if(r>i){return 1}if(e.priority<n.priority){return-1}if(e.priority>n.priority){return 1}return 0}};this.start=function(e){i=Date.now();var n=a(e);t.sort(n);for(var r=0,s=t.length;r<s;r++){var u=t[r];u.status=o.WAITING;u.resource.start(this)}setTimeout(f,100)};var f=function(){var n=false,r=Date.now()-s,i=r>=e.noProgressTimeout,u=r>=e.loggingDelay;for(var a=0,l=t.length;a<l;a++){var c=t[a];if(c.status!==o.WAITING){continue}if(c.resource.checkStatus){c.resource.checkStatus()}if(c.status===o.WAITING){if(i){c.resource.onTimeout()}else{n=true}}}if(u&&n){h()}if(n){setTimeout(f,e.statusInterval)}};this.isBusy=function(){for(var e=0,n=t.length;e<n;e++){if(t[e].status===o.QUEUED||t[e].status===o.WAITING){return true}}return false};var l=function(e,n){var i=null,u,a,f,l,h;for(u=0,a=t.length;u<a;u++){if(t[u].resource===e){i=t[u];break}}if(i==null||i.status!==o.WAITING){return}i.status=n;s=Date.now();f=e.tags.length;for(u=0,a=r.length;u<a;u++){l=r[u];if(l.tags.length===0){h=true}else{h=e.tags.intersects(l.tags)}if(h){c(i,l)}}};this.onLoad=function(e){l(e,o.LOADED)};this.onError=function(e){l(e,o.ERROR)};this.onTimeout=function(e){l(e,o.TIMEOUT)};var c=function(e,n){var r=0,i=0,s,u,a,f;for(s=0,u=t.length;s<u;s++){a=t[s];f=false;if(n.tags.length===0){f=true}else{f=a.resource.tags.intersects(n.tags)}if(f){i++;if(a.status===o.LOADED||a.status===o.ERROR||a.status===o.TIMEOUT){r++}}}n.callback({resource:e.resource,loaded:e.status===o.LOADED,error:e.status===o.ERROR,timeout:e.status===o.TIMEOUT,completedCount:r,totalCount:i})};var h=this.log=function(e){if(!window.console){return}var n=Math.round((Date.now()-i)/1e3);window.console.log("PxLoader elapsed: "+n+" sec");for(var r=0,s=t.length;r<s;r++){var u=t[r];if(!e&&u.status!==o.WAITING){continue}var a="PxLoader: #"+r+" "+u.resource.getName();switch(u.status){case o.QUEUED:a+=" (Not Started)";break;case o.WAITING:a+=" (Waiting)";break;case o.LOADED:a+=" (Loaded)";break;case o.ERROR:a+=" (Error)";break;case o.TIMEOUT:a+=" (Timeout)";break}if(u.resource.tags.length>0){a+=" Tags: ["+u.resource.tags.all.join(",")+"]"}window.console.log(a)}}}function n(e){this.all=[];this.first=null;this.length=0;this.lookup={};if(e){if(Array.isArray(e)){this.all=e.slice(0)}else if(typeof e==="object"){for(var t in e){if(e.hasOwnProperty(t)){this.all.push(t)}}}else{this.all.push(e)}this.length=this.all.length;if(this.length>0){this.first=this.all[0]}for(var n=0;n<this.length;n++){this.lookup[this.all[n]]=true}}}n.prototype.intersects=function(e){if(this.length===0||e.length===0){return false}if(this.length===1&&e.length===1){return this.first===e.first}if(e.length<this.length){return e.intersects(this)}for(var t in this.lookup){if(e.lookup[t]){return true}}return false};if(typeof define==="function"&&define.amd){define("PxLoader",[],function(){return t})}e.PxLoader=t})(this);if(!Date.now){Date.now=function(){return(new Date).getTime()}}if(!Array.isArray){Array.isArray=function(e){return Object.prototype.toString.call(e)==="[object Array]"}}PxLoader.prototype.addImage=function(e,t,n){var r=new PxLoaderImage(e,t,n);this.add(r);return r.img};if(typeof define==="function"&&define.amd){define("PxLoaderImage",[],function(){return PxLoaderImage})}